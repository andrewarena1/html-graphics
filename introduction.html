<!DOCTYPE html>
<html>

<head>
    <title>
        above a hello world
    </title>
</head>

<body>
    <h1 id="yespilates"> welcome </h1>
    <h2 id="modes"></h2>
    <button id="linetype1"><img src="button.png"></button>
    <script>
        //get screen dimensions
        let screenWidth = window.screen.width;
        let screenHeight = window.screen.height;
        //create the canvas, set attributes
        var canvas = document.createElement('canvas');
        canvas.id = "nopilates"
        canvas.width = screenWidth;
        canvas.height = screenHeight;
        canvas.style = "border:1px solid #000000";
        //attach it to the body of the page and get ID
        var body = document.getElementsByTagName("body")[0];
        body.appendChild(canvas);
        //get ids
        var id = document.getElementById("nopilates");
        var idtx = id.getContext("2d")
        idtx.imageSmoothingEnabled = "true";
        var textid1 = document.getElementById("yespilates");
        var textid2 = document.getElementById("modes");
        var button1 = document.getElementById("linetype1");
        button1.addEventListener("mousedown", lineset);
        //globals 
        var under;
        var startx = 0;
        var starty = 0;
        var isMenuing = false;
        idtx.font = "48px serif";
        var currentmenu;
        //menu constructor 
        class Menu {

            constructor(x, y, boundingx, boundingy, numbuttons, fill, border, borderthick, altfill) {
                this.x = x;
                this.y = y;
                this.boundingx = boundingx;
                this.boundingy = boundingy;
                this.buttons = [];
                this.fill = fill || "#545454";
                this.border = border || "#05998c";
                this.borderthick = borderthick || 2;
                this.altfill = altfill || "#7f7f7f";
                this.under = idtx.getImageData(this.x - this.borderthick, this.y - this.borderthick, this.boundingx + 2 * this.borderthick, this.boundingy + 2 * this.borderthick);

                if (this.buttons === 0) {
                    console.log("just a button");

                } else {
                    for (var i = 0; i < numbuttons; i++) {
                        this.buttons.push(new Button(this.x, this.y + this.boundingy * i / numbuttons, this.boundingx, this.boundingy / numbuttons, this.fill, this.border, this.borderthick, this.altfill));
                    }
                    console.log(this.buttons);
                }
            }
            inPosition(mousex, mousey) {
                if (Math.abs(this.x - mousex) < this.boundingx && Math.abs(this.y - mousey) < this.boundingy) {
                    return true;
                }
                return false;
            }
            display() {
                for (let i in this.buttons) {
                    this.buttons[i].drawMe();
                }
                currentmenu = this;
                console.log(currentmenu);
            }

        }
        class Button {
            constructor(x, y, boundingx, boundingy, fill, border, borderthick, altfill, altborder) {
                this.x = x;
                this.y = y;
                this.boundingx = boundingx;
                this.boundingy = boundingy;
                this.fill = fill || "#545454";
                this.border = border || "#05998c";
                this.borderthick = borderthick || 2;
                this.altfill = altfill || "#7f7f7f";
                this.altborder = altborder || "#fabc35"
                this.callback;
                this.alt;
            }
            inPosition(mousex, mousey) {
                console.log(mousey - this.y);
                var ydiff = mousey - this.y;
                var xdiff = mousex - this.x;
                if ((0 < ydiff) && (ydiff < this.boundingy) && (0 < xdiff) && (xdiff < this.boundingx)) {
                    console.log(true);
                    return true;
                }
                console.log(false);
                return false;
            }
            drawMe() {
                drawRect(this.x, this.y, this.boundingx, this.boundingy, this.fill, this.border, this.borderthick);
                this.alt = false;
            }
            drawAlt() {
                drawRect(this.x, this.y, this.boundingx, this.boundingy, this.altfill, this.altborder, this.borderthick);
                this.alt = true;
            }
        }
        //drawrect
        function drawRect(xmin, ymin, width, height, fill, border, linewidth) {
            idtx.beginPath();
            idtx.fillStyle = fill;
            idtx.strokeStyle = border;
            idtx.lineWidth = linewidth;
            idtx.rect(xmin, ymin, width, height);
            idtx.fill();
            idtx.stroke();
            idtx.closePath();
        }

        //click Event Listeners
        id.addEventListener("mousedown", (e) => {
            x = e.offsetX;
            y = e.offsetY;
            if (isMenuing === false) {
                isDrawing = true;
            } else {
                idtx.putImageData(currentmenu.under, currentmenu.x - currentmenu.borderthick, starty - currentmenu.borderthick);
                isMenuing = false;
                textid1.innerHTML = "welcome";

            }
        });

        id.addEventListener("mousemove", (e) => {
            if (isDrawing) {
                drawLine(idtx, x, y, e.offsetX, e.offsetY);
            }
            if (isMenuing) {
                var currentx = e.offsetX;
                var currenty = e.offsetY;
                for (button in currentmenu.buttons) {
                    if (currentmenu.buttons[button].inPosition(currentx, currenty) === true) {
                        currentmenu.buttons[button].drawAlt();
                    }
                }

            }
            x = e.offsetX;
            y = e.offsetY;
        });

        window.addEventListener("mouseup", (e) => {
            if (isDrawing) {
                drawLine(idtx, x, y, e.offsetX, e.offsetY);
                x = 0;
                y = 0;
                isDrawing = false;
            }
        });

        function drawLine(context, x1, y1, x2, y2) {
            context.beginPath();
            context.strokeStyle = "black";
            context.lineWidth = 1;
            context.moveTo(x1, y1);
            context.lineTo(x2, y2);
            context.stroke();
            context.closePath();
        };

        //key Event Listener
        document.addEventListener("keydown", (event) => {
            console.log(event.keyCode);
            if (event.keyCode === 66) { //break
                calledtimes = 0;
                textid1.innerHTML = "b: break";
            }
            if (event.keyCode === 77 && isMenuing === false) { //menu
                textid1.innerHTML = "m: menu";
                startx = x;
                starty = y;
                isMenuing = true;
                var menuwidth = 100;
                var menuheight = 100;

                const thing = new Menu(startx, starty, menuwidth, menuheight, 4);
                thing.display();
            }

            if (event.keyCode === 50) {

            }
        });
    </script>
</body>

</html>